services:
  sfu-a:
    build:
      context: ./packages/sfu
    network_mode: "host"
    environment:
      SFU_PORT: "3031"
      SFU_INSTANCE_ID: "sfu-a"
      SFU_SECRET: ${SFU_SECRET}
      SFU_DRAINING: "false"
      RTC_MIN_PORT: "40000"
      RTC_MAX_PORT: "41000"
      ANNOUNCED_IP: ${ANNOUNCED_IP}
      PLAIN_TRANSPORT_ANNOUNCED_IP: ${PLAIN_TRANSPORT_ANNOUNCED_IP:-${ANNOUNCED_IP}}
      SFU_VERSION: "v1"
    restart: unless-stopped

  sfu-b:
    build:
      context: ./packages/sfu
    network_mode: "host"
    environment:
      SFU_PORT: "3032"
      SFU_INSTANCE_ID: "sfu-b"
      SFU_SECRET: ${SFU_SECRET}
      SFU_DRAINING: "false"
      RTC_MIN_PORT: "41001"
      RTC_MAX_PORT: "42000"
      ANNOUNCED_IP: ${ANNOUNCED_IP}
      PLAIN_TRANSPORT_ANNOUNCED_IP: ${PLAIN_TRANSPORT_ANNOUNCED_IP:-${ANNOUNCED_IP}}
      SFU_VERSION: "v2"
    restart: unless-stopped

  browser-service:
    build:
      context: ./packages/shared-browser
    network_mode: "host"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      BROWSER_SERVICE_PORT: "3040"
      NOVNC_PORT_START: "6080"
      NOVNC_PORT_END: "6100"
      BROWSER_HOST_ADDRESS: ${BROWSER_HOST_ADDRESS:-localhost}
      BROWSER_PUBLIC_BASE_URL: ${BROWSER_PUBLIC_BASE_URL:-}
      BROWSER_IMAGE_NAME: "conclave-browser:latest"
    restart: unless-stopped
